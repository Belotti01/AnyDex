@using System.Diagnostics
@typeparam TSelf
@inherits MudComponentBase

@code {
    [CascadingParameter, NotNull]
    public Task<AuthenticationState>? AuthenticationStateTask { get; set; }
    [Inject, NotNull]
    public SignInManager<User>? SignInManager { get; set; }
    public UserManager<User> UserManager => SignInManager.UserManager;

    /// <summary>
    /// Logs' output stream accessor object for components.
    /// </summary>
    [Inject, NotNull]
    protected ILogger<TSelf>? Logger { get; private set; }

    protected override void OnInitialized() {
        base.OnInitialized();

        TryValidateInitializationValues();
    }

    public string Localize(string text) {
        // Unimplemented for now
        return text;
    }

    public virtual bool TryValidateInitializationValues() {
        bool isCurrentFieldInvalid;
        bool isAnyFieldInvalid = false;

        // Check Logger first, as other errors can't be signaled if it's not set
        if(Logger is null) {
            if(Debugger.IsAttached) {
                throw new NullReferenceException($"Logging can't be computed due to field '{nameof(Logger)}' of type '{typeof(ILogger).Name}' having no value.");
            }else {
                return false;
            }
        }

        if(isCurrentFieldInvalid = AuthenticationStateTask is null)
            LogNullRequiredField(nameof(AuthenticationStateTask));
        isAnyFieldInvalid &= isCurrentFieldInvalid;

        if(isCurrentFieldInvalid = SignInManager is null)
            LogNullRequiredField(nameof(SignInManager));
        isAnyFieldInvalid &= isCurrentFieldInvalid;

        return isAnyFieldInvalid;
    }

    protected void LogNullRequiredField(string fieldName) {
        Logger.LogCritical("Required Base Component field '{fieldName}' has no set value.", fieldName);
    }

}