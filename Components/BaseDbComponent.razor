@inherits BaseComponent<TSelf>
@typeparam TSelf

@code {
	/// <summary>
	/// Components' database accessor object.
	/// </summary>
	[Inject, NotNull]
	protected AnyDexDb? DbContext { get; private set; }

	public async Task<User?> GetCurrentUserAsync() {
		User user;
		var auth = await AuthenticationStateTask;

		if(auth.User.Identity is null) {
			return null;
		}

		user = await UserManager.GetUserAsync(auth.User);
#if DEBUG
	string username = user?.UserName ?? "<Guest>";
	Logger.LogDebug("Current User: {username}", username);
#endif

		return user;
	}

	public override bool TryValidateInitializationValues() {
		bool isAnyFieldInvalid = base.TryValidateInitializationValues();
		bool isCurrentFieldInvalid;
		if(Logger is null) return false;	// Can't log errors. 
											// Done after calling the overrided method to properly handle Logger null value in 
											// the base method.


		if(isCurrentFieldInvalid = DbContext is null)
			LogNullRequiredField(nameof(DbContext));
		isAnyFieldInvalid &= isCurrentFieldInvalid;

		return isAnyFieldInvalid;
	}
}
